[ZHbb]
;!! --------------------------------
;!! Variables and values definition
;!! --------------------------------
;# BTAG working points
;# https://twiki.cern.ch/twiki/bin/viewauth/CMS/BTagPerformanceOP
;CSV_VeryLoose = 0.4
;CSV_Loose = 0.605
;CSV_Medium = 0.890
;CSV_Tight = 0.970

CSV_VeryLoose = 0.4
CSV_Loose = 0.460
CSV_Medium = 0.800
CSV_Tight =  0.935

maxCSVMed = (Jet_btagCSV[hJCidx[0]] > <!ZHbb|CSV_Medium!>)

VtypeZvv    = (Vtype==4)
VtypeW      = (Vtype==2||Vtype==3)

;#See https://twiki.cern.ch/twiki/bin/viewauth/CMS/SWGuideMuonIdRun2#Muon_Isolation
;VetoMuon = (Sum$(aLeptons_looseIdPOG>0 && aLeptons_pfRelIso04<0.50 && abs(aLeptons_pdgId)==13 && aLeptons_pt>5) + Sum$(vLeptons_looseIdPOG>0 && vLeptons_pfRelIso04<0.50 && abs(vLeptons_pdgId)==13 && vLeptons_pt>5))
VetoMuon = (Sum$(aLeptons_pfRelIso04<0.50 && abs(aLeptons_pdgId)==13 && aLeptons_pt>5))
;TightMuon = (Sum$(aLeptons_tightId>0 && aLeptons_pfRelIso04<0.15 && abs(aLeptons_pdgId)==13 && aLeptons_pt>20) + Sum$(vLeptons_tightId>0 && vLeptons_pfRelIso04<0.15 && abs(vLeptons_pdgId)==13 && vLeptons_pt>20))
TightMuon = Sum$(vLeptons_tightId>0 && vLeptons_pfRelIso04<0.15 && abs(vLeptons_pdgId)==13 && vLeptons_pt>20)

;#See https://twiki.cern.ch/twiki/bin/view/CMS/EgammaIDRecipesRun2 (in particular CutBasedElectronIdentificationRun2)
;VetoElectron =  (Sum$(aLeptons_eleCutIdSpring15_25ns_v1>0 && aLeptons_pfRelIso04<0.50 && abs(aLeptons_pdgId)==11 && aLeptons_pt>5) + Sum$(vLeptons_eleCutIdSpring15_25ns_v1>0 && vLeptons_pfRelIso04<0.50 && abs(vLeptons_pdgId)==11 && vLeptons_pt>5))
VetoElectron =  (Sum$(aLeptons_pfRelIso04<0.50 && abs(aLeptons_pdgId)==11 && aLeptons_pt>5) )
;TightElectron = (Sum$(aLeptons_eleCutIdSpring15_25ns_v1>3 && aLeptons_pfRelIso04<0.15 && abs(aLeptons_pdgId)==11 && aLeptons_pt>20) + Sum$(vLeptons_eleCutIdSpring15_25ns_v1>3 && vLeptons_pfRelIso04<0.15 && abs(vLeptons_pdgId)==11 && vLeptons_pt>20))
TightElectron = Sum$(vLeptons_pfRelIso04<0.15 && abs(vLeptons_pdgId)==11 && vLeptons_pt>20)
;TightElectron = (Sum$(aLeptons_pfRelIso04<0.15 && abs(aLeptons_pdgId)==11 && aLeptons_pt>20) + Sum$(vLeptons_pfRelIso04<0.15 && abs(vLeptons_pdgId)==11 && vLeptons_pt>20))
;#All muons pass already aLeptons_looseIdPOG

;#See https://twiki.cern.ch/twiki/bin/view/CMS/EgammaIDRecipesRun2

minBtag = min(Jet_btagCSV[hJCidx[0]],Jet_btagCSV[hJCidx[1]])
maxBtag = max(Jet_btagCSV[hJCidx[0]],Jet_btagCSV[hJCidx[1]])

;MassVeto= (HCSV_reg_mass < 90. | HCSV_reg_mass > 150.)
MassHiggs= (HCSV_reg_mass > 90. && HCSV_reg_mass < 150.)

addJetNoPU30 = (Sum$(Jet_pt[aJCidx]>30 && Jet_puId[aJCidx]>=4))
addCenJet40 = (Sum$(Jet_pt>40 && abs(Jet_eta)<5.2)-2)
addCenJet30 = (Sum$(Jet_pt>30 && abs(Jet_eta)<5.2)-2)
addCenJet20 = (Sum$(Jet_pt>20 && abs(Jet_eta)<5.2)-2)
VetoLeptons = (<!ZHbb|VetoMuon!> + <!ZHbb|VetoElectron!>)
TightLeptons = (<!ZHbb|TightMuon!> + <!ZHbb|TightElectron!>)
naddGoodLeptons5 = (<!ZHbb|VetoLeptons!>)
nJets30 = Sum$(Jet_pt>30 && abs(Jet_eta)<5.2 && Jet_puId>=4)
nJets40 = Sum$(Jet_pt>40 && abs(Jet_eta)<5.2 && Jet_puId>=4)
HdR = ((Jet_eta[hJCidx[0]]-Jet_eta[hJCidx[1]])**2 + (TVector2::Phi_mpi_pi(Jet_phi[hJCidx[0]]-Jet_phi[hJCidx[1]]))**2 )**0.5
HdPhi = abs(TVector2::Phi_mpi_pi(vLeptons_phi[0]-met_phi))

smallLeptMET= ( abs(TVector2::Phi_mpi_pi(Alt$(vLeptons_phi[0],-999)-met_phi))    < 0.785 )
smallHdPhi  = ( abs(TVector2::Phi_mpi_pi(Jet_phi[hJCidx[0]]-Jet_phi[hJCidx[1]])) < 0.785 ) 
;#1.57

fourJets = ( Sum$(Jet_pt>30 && abs(Jet_eta)<5.2 && Jet_puId>=4) >=4 )

;!! ----------------------------------------
;!! Region definitions
;!! ----------------------------------------
[Cuts]

TriggerSingleEle = (HLT_BIT_HLT_Ele23_WPLoose_Gsf_v)
TriggerSingleMu = (HLT_BIT_HLT_IsoMu20_v)
TriggerMET90 = (HLT_BIT_HLT_PFMET90_PFMHT90_IDTight_v)
TriggerMET = (HLT_BIT_HLT_PFMET90_PFMHT90_IDTight_v||HLT_BIT_HLT_PFMET170_NoiseCleaned_v)

Flags = Flag_EcalDeadCellTriggerPrimitiveFilter && Flag_trkPOG_manystripclus53X && Flag_ecalLaserCorrFilter && Flag_trkPOG_toomanystripclus53X && Flag_hcalLaserEventFilter && Flag_trkPOG_logErrorTooManyClusters && Flag_trkPOGFilters  && Flag_HBHENoiseFilter && Flag_goodVertices && Flag_METFilters && Flag_eeBadScFilter  && Flag_CSCTightHaloFilter

FlagsMET = Flag_hbheFilterNew  &&Flag_hbheIsoFilter &&Flag_CSCTightHaloFilter &&Flag_eeBadScFilter && Flag_goodVertices && Flag_EcalDeadCellTriggerPrimitiveFilter

Nothing     = 1
QCD         = 1
NoQCDLoose  = <!Cuts|Nothing!>

NoQCDTight  = (Sum$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi))<0.4 && Jet_pt>30 && Jet_puId>=4)==0)
TurnOnEleDen = <!Cuts|NoQCD3!> && <!Cuts|TriggerSingleEle!> && Alt$(selLeptons_pt[0],0)>23 && Alt$(selLeptons_pt[0],0)<60
TurnOnEleNum = <!Cuts|TurnOnEleDen!> && <!Cuts|TriggerMET90!>

TurnOnMuDen = <!Cuts|NoQCD3!> && <!Cuts|TriggerSingleMu!> && Alt$(selLeptons_pt[0],0)>20 && Alt$(selLeptons_pt[0],0)<60
TurnOnMuNum = <!Cuts|TurnOnMuDen!> && <!Cuts|TriggerMET90!>

TurnOnTTEleDen = <!Cuts|TurnOnEleDen!> && <!ZHbb|addCenJet30!> && Jet_btagCSV[hJCidx[0]]>0.941
TurnOnTTEleNum = <!Cuts|TurnOnTTEleDen!> && <!Cuts|TriggerMET90!>

TurnOnTTMuDen = <!Cuts|TurnOnMuDen!> && <!ZHbb|addCenJet30!> && Jet_btagCSV[hJCidx[0]]>0.941
TurnOnTTMuNum = <!Cuts|TurnOnTTMuDen!> && <!Cuts|TriggerMET90!>

TurnOnQCDEleDen = <!Cuts|QCD!> && <!Cuts|TriggerSingleEle!> && Alt$(selLeptons_pt[0],0)>23 && Alt$(selLeptons_pt[0],0)<60
TurnOnQCDEleNum = <!Cuts|TurnOnQCDEleDen!> && <!Cuts|TriggerMET90!>

TurnOnQCDMuDen = <!Cuts|QCD!> && <!Cuts|TriggerSingleMu!> && Alt$(selLeptons_pt[0],0)>20 && Alt$(selLeptons_pt[0],0)<60
TurnOnQCDMuNum = <!Cuts|TurnOnQCDMuDen!> && <!Cuts|TriggerMET90!>

TurnOnQCDTTEleDen = <!Cuts|TurnOnQCDEleDen!> && <!ZHbb|addCenJet30!> && Jet_btagCSV[hJCidx[0]]>0.941
TurnOnQCDTTEleNum = <!Cuts|TurnOnQCDTTEleDen!> && <!Cuts|TriggerMET90!>

TurnOnQCDTTMuDen = <!Cuts|TurnOnQCDMuDen!> && <!ZHbb|addCenJet30!> && Jet_btagCSV[hJCidx[0]]>0.941
TurnOnQCDTTMuNum = <!Cuts|TurnOnQCDTTMuDen!> && <!Cuts|TriggerMET90!>

TurnOnCSVQCDTTEleDen = <!Cuts|TurnOnQCDEleDen!> && <!ZHbb|addCenJet40!> >=1 && trgObjects_caloMhtNoPU_pt>90
TurnOnCSVQCDTTEleNum = <!Cuts|TurnOnCSVQCDTTEleDen!> && ntrgObjects_hltCSV0p72L3>=1

TurnOnCSVQCDTTMuDen = <!Cuts|TurnOnQCDMuDen!> && <!ZHbb|addCenJet40!> >=1 && trgObjects_caloMhtNoPU_pt>90
TurnOnCSVQCDTTMuNum = <!Cuts|TurnOnCSVQCDTTMuDen!> && ntrgObjects_hltCSV0p72L3>=1

TurnOnCSVQCDEleDen = <!Cuts|TurnOnQCDEleDen!> && trgObjects_caloMhtNoPU_pt>90
TurnOnCSVQCDEleNum = <!Cuts|TurnOnCSVQCDEleDen!> && ntrgObjects_hltCSV0p72L3>=1

TurnOnCSVQCDMuDen = <!Cuts|TurnOnQCDMuDen!> && trgObjects_caloMhtNoPU_pt>90
TurnOnCSVQCDMuNum = <!Cuts|TurnOnCSVQCDMuDen!> && ntrgObjects_hltCSV0p72L3>=1

Cut_Z   = <!Cuts|Nothing!>
Cut_TT  = <!Cuts|Nothing!>  && <!ZHbb|fourJets!> && !<!ZHbb|smallHdPhi!> && nselLeptons>=1 && <!ZHbb|TightLeptons!> >=1 
Cut_W   = <!Cuts|Nothing!>  && <!ZHbb|TightLeptons!> ==1 && nselLeptons==1  && (abs(TVector2::Phi_mpi_pi(vLeptons_phi[0]-met_phi))<1.57) && (abs(TVector2::Phi_mpi_pi(Jet_phi[hJCidx[0]]-Jet_phi[hJCidx[1]]))<0.785) && (<!ZHbb|addJetNoPU30!> <= 1)

#DC_TTbarTight   = <!ZHbb|VtypeW!>   && <!ZHbb|maxCSVMed!>   && nselLeptons>=1 && <!ZHbb|fourJets!> && met_pt>200
##<!Cuts|Cut_TT!>  && <!ZHbb|maxCSVMed!> && <!ZHbb|VtypeW!> 
#DC_WLight       = <!ZHbb|VtypeW!>   && <!Cuts|Cut_W!>   && !<!ZHbb|maxCSVMed!>
#DC_Wbb          = <!ZHbb|VtypeW!>   && <!Cuts|Cut_W!>   && <!ZHbb|maxCSVMed!> && !<!ZHbb|MassHiggs!>
#DC_QCD          = <!ZHbb|VtypeZvv!> && <!Cuts|Cut_Z!>   && 1                                            && 1                    && <!Cuts|NoQCDLoose!>  && !<!Cuts|NoQCDTight!>
#DC_ZLight       = <!ZHbb|VtypeZvv!> && <!Cuts|Cut_Z!>   && !<!ZHbb|maxCSVMed!> && 1                    && <!Cuts|NoQCDLoose!>  && <!Cuts|NoQCDTight!>
#DC_Zbb          = <!ZHbb|VtypeZvv!> && <!Cuts|Cut_Z!>   && <!ZHbb|maxCSVMed!> && !<!ZHbb|MassHiggs!>    && <!Cuts|NoQCDLoose!>  && <!Cuts|NoQCDTight!>
#DC_Signal       = <!ZHbb|VtypeZvv!> && 1                && <!ZHbb|maxCSVMed!> && 1                    && <!Cuts|NoQCDLoose!>
#DC_SignalTight  = <!ZHbb|VtypeZvv!> && <!Cuts|Cut_Z!>   && <!ZHbb|maxCSVMed!> && <!ZHbb|MassHiggs!>   && <!Cuts|NoQCDLoose!>


#-------------------------------------------------
# Control Region Cuts

VtypeW = (Vtype==2||Vtype==3)
VtypeZnn = Vtype==4
maxCSVMed = (Jet_btagCSV[hJCidx[0]]>0.800)
fourJets = (Sum$(Jet_pt>30 && abs(Jet_eta)<5.2 && Jet_puId>=7)>=4)
MassHiggs = (HCSV_mass>90 && HCSV_mass<150)
smallLeptMET = (abs(TVector2::Phi_mpi_pi(Alt$(vLeptons_phi[0],-999)-met_phi))<0.785)
smallHdPhi = (abs(TVector2::Phi_mpi_pi(Jet_phi[hJCidx[0]]-Jet_phi[hJCidx[1]]))<0.785)
NoQCDTight = (Sum$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi))<0.4 && Jet_pt>30 && Jet_puId>=7)==0)

DC_TTbarTight  = <!Cuts|VtypeW!> && <!Cuts|maxCSVMed!> && nselLeptons>=1 && <!Cuts|fourJets!>
DC_WLight      = <!Cuts|VtypeW!> && !<!Cuts|maxCSVMed!> && nselLeptons==1
DC_Wbb         = <!Cuts|VtypeW!> && <!Cuts|maxCSVMed!> && nselLeptons==1 && !<!Cuts|fourJets!> && !<!Cuts|MassHiggs!> && <!Cuts|smallHdPhi!> && <!Cuts|smallLeptMET!>
DC_QCD         = <!Cuts|VtypeZnn!> && nselLeptons==0 && !<!Cuts|NoQCDTight!>
DC_ZLight      = <!Cuts|VtypeZnn!> && nselLeptons==0 && !<!Cuts|maxCSVMed!> && <!Cuts|NoQCDTight!>
DC_Zbb         = Vtype==4 && nselLeptons==0 && Jet_btagCSV[hJCidx[0]]>0.8 && Sum$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi))>0.4 && Jet_pt>30 && Jet_puId>=7)==0 && (HCSV_mass<90||HCSV_mass>150)
DC_Signal      = <!Cuts|VtypeZnn!> && nselLeptons==0 && <!Cuts|maxCSVMed!> && <!Cuts|NoQCDTight!>
DC_SignalTight = <!Cuts|VtypeZnn!> && nselLeptons==0 && <!Cuts|maxCSVMed!> && <!Cuts|MassHiggs!> && <!Cuts|NoQCDTight!>

CR_TTbarTight = <!Cuts|DC_TTbarTight!> 
CR_WLight     = <!Cuts|DC_WLight!>
CR_Wbb        = <!Cuts|DC_Wbb!>
CR_ZLight     = <!Cuts|DC_ZLight!>
CR_Zbb        = <!Cuts|DC_Zbb!>
CR_QCD        = <!Cuts|DC_QCD!>
Signal        = <!Cuts|DC_Signal!>
SignalTight   = <!Cuts|DC_SignalTight!>


##########
DC_Z            = <!ZHbb|VtypeZvv!> && nselLeptons==0   && <!Cuts|NoQCDLoose!>  && <!Cuts|NoQCDTight!> && !(<!ZHbb|maxCSVMed!> && (<!ZHbb|MassHiggs!>||<!ZHbb|fourJets!>))
DC_W            = <!ZHbb|VtypeW!>   && nselLeptons==1   && !(<!ZHbb|maxCSVMed!> && <!ZHbb|MassHiggs!>)
DC_TTbar        = <!ZHbb|VtypeW!>   && nselLeptons>=1   && 1                    && <!ZHbb|fourJets!>
CR_TTbar      = <!Cuts|DC_TTbar!>

CR_Nothing      = <!Cuts|NoQCDLoose!>
CR_W            = <!Cuts|DC_W!>
CR_Z            = <!Cuts|DC_Z!>

HighPt                  = HCSV_reg_pt>150  && min(met_pt,mhtJet30)>150

DC_HighPt_TTbarTight    = <!Cuts|HighPt!>       && <!Cuts|DC_TTbarTight!>
DC_HighPt_WLight        = <!Cuts|HighPt!>       && <!Cuts|DC_WLight!>
DC_HighPt_Wbb           = <!Cuts|HighPt!>       && <!Cuts|DC_Wbb!>
DC_HighPt_ZLight        = <!Cuts|HighPt!>       && <!Cuts|DC_ZLight!>
DC_HighPt_Zbb           = <!Cuts|HighPt!>       && <!Cuts|DC_Zbb!>
DC_HighPt_QCD           = <!Cuts|HighPt!>       && <!Cuts|DC_QCD!>
DC_HighPt_Signal        = <!Cuts|HighPt!>       && <!Cuts|DC_Signal!>
DC_HighPt_SignalTight   = <!Cuts|HighPt!>       && <!Cuts|DC_SignalTight!>

CR_HighPtTTbarTight    = <!Cuts|DC_HighPt_TTbarTight!>
CR_HighPtWLight        = <!Cuts|DC_HighPt_WLight!>
CR_HighPtWbb           = <!Cuts|DC_HighPt_Wbb!>
CR_HighPtZLight        = <!Cuts|DC_HighPt_ZLight!>
CR_HighPtZbb           = <!Cuts|DC_HighPt_Zbb!>
CR_HighPtQCD           = <!Cuts|DC_HighPt_QCD!>
SignalHighPt           = <!Cuts|DC_HighPt_Signal!>
SignalTightHighPt      = <!Cuts|DC_HighPt_SignalTight!>

;# the cut HCSV_reg_pt>120  && min(met_pt,mhtJet30)>120 is already included in DC_XXX
LowPt                   = !(HCSV_reg_pt>150  && min(met_pt,mhtJet30)>150)

DC_LowPt_TTbarTight     = <!Cuts|LowPt!>        && <!Cuts|DC_TTbarTight!>
DC_LowPt_WLight         = <!Cuts|LowPt!>        && <!Cuts|DC_WLight!>
DC_LowPt_Wbb            = <!Cuts|LowPt!>        && <!Cuts|DC_Wbb!>
DC_LowPt_ZLight         = <!Cuts|LowPt!>        && <!Cuts|DC_ZLight!>
DC_LowPt_Zbb            = <!Cuts|LowPt!>        && <!Cuts|DC_Zbb!>
DC_LowPt_QCD            = <!Cuts|LowPt!>        && <!Cuts|DC_QCD!>
DC_LowPt_Signal         = <!Cuts|LowPt!>        && <!Cuts|DC_Signal!>
DC_LowPt_SignalTight    = <!Cuts|LowPt!>        && <!Cuts|DC_SignalTight!>

CR_LowPtTTbarTight     = <!Cuts|DC_LowPt_TTbarTight!>
CR_LowPtWLight         = <!Cuts|DC_LowPt_WLight!>
CR_LowPtWbb            = <!Cuts|DC_LowPt_Wbb!>
CR_LowPtZLight         = <!Cuts|DC_LowPt_ZLight!>
CR_LowPtZbb            = <!Cuts|DC_LowPt_Zbb!>
CR_LowPtQCD            = <!Cuts|DC_LowPt_QCD!>
SignalLowPt            = <!Cuts|DC_LowPt_Signal!>
SignalTightLowPt       = <!Cuts|DC_LowPt_SignalTight!>

################################################


;Cut_Wbb         = <!Cuts|NoQCD3!>       && VetoLeptons==1 && (addJetNoPU20)==0 && Jet_btagCSV[hJCidx[0]]> <!ZHbb|CSV_Medium!> && HCSV_reg_pt>170 && MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi)),Jet_pt>20  && Jet_eta<5.2 )>2

AllBDT = <!Cuts|NoQCD3!>    && Vtype==4 && <!ZHbb|TightLeptons!> <=1 && Jet_btagCSV[hJCidx[1]] > <!ZHbb|CSV_Loose!> && HCSV_reg_pt>150
All = <!Cuts|AllBDT!>       && Jet_btagCSV[hJCidx[1]] > <!ZHbb|CSV_Medium!>  && Jet_btagCSV[hJCidx[0]] > <!ZHbb|CSV_Tight!> && addCenJet30==0 && <!ZHbb|VetoLeptons!> ==0
CutAndCount = <!Cuts|All!>  && HCSV_reg_mass<140 && HCSV_reg_mass>105 && met_pt>160
; && HCSV_reg_pt>160 && Jet_btagCSV[hJCidx[1]]>0.2 && abs(TVector2::Phi_mpi_pi(HCSV_reg_phi-met_phi))>1.5 && min(Jet_pt[hJCidx[0]],Jet_pt[hJCidx[1]])>30 && HCSV_reg_mass<300 && HCSV_mass>0 && minDeltaPhiJet2Met>0.7 && minDeltaPhiCenJetNoPU30Met >0.5 && tkMetPVchs_pt>25 && tkMet_pt>25
AllBDTWithWeights = ( <!Cuts|AllBDT!> )
AllBDTOnlyPositiveWeights = ( <!Cuts|AllBDT!> && sign(genWeight)>0 )

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

BDTNoMjj_CR                     = <!Cuts|DC_Signal!>    && ZvvBDTNoMjj.nominal>-0.2 && ZvvBDTNoMjj.nominal<0.2
BDTNoMjj_LowPurity              = <!Cuts|DC_Signal!>    && ZvvBDTNoMjj.nominal>0.2  && ZvvBDTNoMjj.nominal<0.6
BDTNoMjj_HighPurity             = <!Cuts|DC_Signal!>    && ZvvBDTNoMjj.nominal>0.6  && ZvvBDTNoMjj.nominal<1

BDTNoMjj_Cut_Zbb                 = <!Cuts|DC_Zbb!>       && ZvvBDTNoMjj.nominal>-0.2 && ZvvBDTNoMjj.nominal<0.2
BDTNoMjj_LowPurity_Zbb          = <!Cuts|DC_Zbb!>       && ZvvBDTNoMjj.nominal>0.2  && ZvvBDTNoMjj.nominal<0.6
BDTNoMjj_HighPurity_Zbb         = <!Cuts|DC_Zbb!>       && ZvvBDTNoMjj.nominal>0.6  && ZvvBDTNoMjj.nominal<1

BDTNoMjj_Cut_ZLight              = <!Cuts|DC_ZLight!>    && ZvvBDTNoMjj.nominal>-0.2 && ZvvBDTNoMjj.nominal<0.2
BDTNoMjj_LowPurity_ZLight       = <!Cuts|DC_ZLight!>    && ZvvBDTNoMjj.nominal>0.2  && ZvvBDTNoMjj.nominal<0.6
BDTNoMjj_HighPurity_ZLight      = <!Cuts|DC_ZLight!>    && ZvvBDTNoMjj.nominal>0.6  && ZvvBDTNoMjj.nominal<1

BDTNoMjj_Cut_Wbb                 = <!Cuts|DC_Wbb!>       && ZvvBDTNoMjj.nominal>-0.2 && ZvvBDTNoMjj.nominal<0.2
BDTNoMjj_LowPurity_Wbb          = <!Cuts|DC_Wbb!>       && ZvvBDTNoMjj.nominal>0.2  && ZvvBDTNoMjj.nominal<0.6
BDTNoMjj_HighPurity_Wbb         = <!Cuts|DC_Wbb!>       && ZvvBDTNoMjj.nominal>0.6  && ZvvBDTNoMjj.nominal<1

BDTNoMjj_Cut_WLight              = <!Cuts|DC_WLight!>    && ZvvBDTNoMjj.nominal>-0.2 && ZvvBDTNoMjj.nominal<0.2
BDTNoMjj_LowPurity_WLight       = <!Cuts|DC_WLight!>    && ZvvBDTNoMjj.nominal>0.2  && ZvvBDTNoMjj.nominal<0.6
BDTNoMjj_HighPurity_WLight      = <!Cuts|DC_WLight!>    && ZvvBDTNoMjj.nominal>0.6  && ZvvBDTNoMjj.nominal<1

BDTNoMjj_Cut_TTTight          = <!Cuts|DC_TTbarTight!> && ZvvBDTNoMjj.nominal>-0.2 && ZvvBDTNoMjj.nominal<0.2
BDTNoMjj_LowPurity_TTbarTight   = <!Cuts|DC_TTbarTight!> && ZvvBDTNoMjj.nominal>0.2  && ZvvBDTNoMjj.nominal<0.6
BDTNoMjj_HighPurity_TTbarTight  = <!Cuts|DC_TTbarTight!> && ZvvBDTNoMjj.nominal>0.6  && ZvvBDTNoMjj.nominal<1

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

NoQCDBeforeSys = <!Cuts|Nothing!> && HCSV_pt>150 && MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi)),Iteration$<2)>0.7 &&  MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi)),Jet_pt>30 && Jet_eta<5.2 && Jet_puId>=4)>0.5 && (Sum$(Jet_pt>30 && abs(Jet_eta)<5.2)-2)<=1 && abs(TVector2::Phi_mpi_pi(tkMetPVchs_phi-met_phi))<0.4 && 1==1
CR_WLightBeforeSys = <!Cuts|NoQCDBeforeSys!>  && (Jet_btagCSV[hJCidx[0]]< <!ZHbb|CSV_Medium!>) && (<!ZHbb|VetoLeptons!>) >=1
CR_WbbBeforeSys = <!Cuts|NoQCDBeforeSys!>   && (Jet_btagCSV[hJCidx[0]]> <!ZHbb|CSV_Medium!>) && (<!ZHbb|VetoLeptons!>) ==1 && <!ZHbb|addCenJet30!>==0 && HCSV_pt>200
CR_ZLightBeforeSys = <!Cuts|NoQCDBeforeSys!>  && (Jet_btagCSV[hJCidx[0]]< <!ZHbb|CSV_Medium!>) && (<!ZHbb|VetoLeptons!>) ==0
CR_ZbbBeforeSys = (Jet_btagCSV[hJCidx[0]]> <!ZHbb|CSV_Medium!>) && (H_mass<110 || H_mass>140) && (<!ZHbb|VetoLeptons!>) ==0

CR_QCDBeforeSys = <!Cuts|Nothing!> && HCSV_pt>100 && MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi)),Iteration$<2)<0.5
CR_TTBeforeSys = <!Cuts|NoQCDBeforeSys!> && (Jet_btagCSV[hJCidx[0]]> <!ZHbb|CSV_Medium!>) && (<!ZHbb|VetoLeptons!>) >=1 && (<!ZHbb|addCenJet30!>) >=1
CR_WBeforeSys = <!Cuts|NoQCDBeforeSys!> && (<!ZHbb|VetoLeptons!>) ==1 && <!ZHbb|addCenJet30!>==0
CR_ZBeforeSys = <!Cuts|NoQCDBeforeSys!> && (H_mass<110 || H_mass>140) && (<!ZHbb|VetoLeptons!>) ==0 && <!ZHbb|addCenJet30!>==0

NoQCDBeforeSys_reg = <!Cuts|NoQCDBeforeSys!>
Cut_TTBeforeSys_reg = <!Cuts|Cut_TTBeforeSys!>

nPVs = <!Cuts|NoQCDBeforeSys!> && met_pt>160 && (Jet_btagCSV[hJCidx[0]]< <!ZHbb|CSV_Medium!> ) && (<!ZHbb|naddGoodLeptons5!>) >=1


AllBDTLog = <!Cuts|AllBDT!>

Muons = <!Cuts|NoQCD3!> && Vtype==4 && naLeptons==1 && aLeptons_pt[0]>40 && abs(aLeptons_pdgId[0])==13
Electrons = <!Cuts|NoQCD3!> && Vtype==4 && naLeptons==1 && aLeptons_pt[0]>40 && abs(aLeptons_pdgId[0])==11

quick = 1

DC_Signal_OnlyPositiveWeights = <!Cuts|DC_Signal!> && sign(genWeight)>0


;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

testBTag20      = <!Cuts|Nothing!>      && <!ZHbb|TightLeptons!> >=1 && nselLeptons>=1 && (<!ZHbb|nJets30!> >  2) && Jet_pt[hJCidx[0]]>20  && Jet_pt[hJCidx[0]]<30
testBTag30      = <!Cuts|Nothing!>      && <!ZHbb|TightLeptons!> >=1 && nselLeptons>=1 && (<!ZHbb|nJets30!> >  2) && Jet_pt[hJCidx[0]]>30  && Jet_pt[hJCidx[0]]<40
testBTag40      = <!Cuts|Nothing!>      && <!ZHbb|TightLeptons!> >=1 && nselLeptons>=1 && (<!ZHbb|nJets30!> >  2) && Jet_pt[hJCidx[0]]>40  && Jet_pt[hJCidx[0]]<60
testBTag60      = <!Cuts|Nothing!>      && <!ZHbb|TightLeptons!> >=1 && nselLeptons>=1 && (<!ZHbb|nJets30!> >  2) && Jet_pt[hJCidx[0]]>60  && Jet_pt[hJCidx[0]]<100
testBTag100     = <!Cuts|Nothing!>      && <!ZHbb|TightLeptons!> >=1 && nselLeptons>=1 && (<!ZHbb|nJets30!> >  2) && Jet_pt[hJCidx[0]]>100

testBTagX       = <!Cuts|Nothing!>      && <!ZHbb|TightLeptons!> >=1 && nselLeptons>=1 && (<!ZHbb|nJets30!> >  -1) && Jet_btagCSV[hJCidx[1]]>0.9875
testBTagY       = <!Cuts|Nothing!>      && <!ZHbb|TightLeptons!> >=1 && nselLeptons>=1 && (<!ZHbb|nJets30!> >  -1) && Jet_btagCSV[hJCidx[1]]>0.935 && Jet_btagCSV[hJCidx[1]]<0.9875

;testBTagZ       = <!Cuts|Nothing!>      && (Vtype==3) && (<!ZHbb|nJets30!> >  -1) && Jet_btagCSV[hJCidx[1]]>0.98 && abs(TVector2::Phi_mpi_pi(selLeptons_phi[0]-met_phi))>0.3 && abs(TVector2::Phi_mpi_pi(selLeptons_phi[0]-met_phi))<0.7 && HCSV_reg_pt>120 && Sum$(Jet_pt[aJCidx]>20 && Jet_puId[aJCidx]==1)>=1 && Sum$(Jet_pt[aJCidx]>20 && Jet_puId[aJCidx]==1)<=2
testBTagZ       = <!Cuts|Nothing!>      && (Vtype==3) && Jet_btagCSV[hJCidx[0]]>0.8 && abs(TVector2::Phi_mpi_pi(selLeptons_phi[0]-met_phi))>0.3 && abs(TVector2::Phi_mpi_pi(selLeptons_phi[0]-met_phi))<0.7

testBTagA       = <!Cuts|Nothing!>      && <!ZHbb|TightLeptons!> >=1 && (Vtype==2||Vtype==3) & Sum$(hJCidx<=1)==2 && Jet_pt[2]>30
;(H_mass>80 && H_mass<130) && Jet_btagCSV[hJCidx[1]]>0.9875 && abs(TVector2::Phi_mpi_pi(selLeptons_phi[0]-met_phi))>0.3 && abs(TVector2::Phi_mpi_pi(selLeptons_phi[0]-met_phi))<0.7

SF_TTbarTight   = <!Cuts|DC_TTbarTight!>
SF_WLight       = <!Cuts|DC_WLight!>
SF_Wbb          = <!Cuts|DC_Wbb!>
SF_ZLight       = <!Cuts|DC_ZLight!>
SF_Zbb          = <!Cuts|DC_Zbb!>
SF_QCD          = <!Cuts|DC_QCD!>
SF_TTbar        = <!Cuts|DC_TTbar!>
SF_W            = <!Cuts|DC_W!>
SF_Z            = <!Cuts|DC_Z!>

