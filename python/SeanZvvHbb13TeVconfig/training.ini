#-------------------------------------------------
# TMVA Factory Settings
[factory]
factoryname = MVA
factorysettings = V:!Silent:!DrawProgressBar:AnalysisType=Classification:Transformations=I

#-------------------------------------------------
# TMVA Classifier Settings
[MVAGeneral]
type = BDT
settings = NTrees=722:MaxDepth=4:MinNodeSize=2.09:nCuts=16:BoostType=Grad:UseBaggedBoost=True:Shrinkage=0.238:NodePurityLimit=0.389:SeparationType=CrossEntropy:MinNodeSize=2.09

#-------------------------------------------------
# Classification Features
[ZvvBDTVars]

Nominal = HCSV_reg_mass HCSV_reg_pt abs(TVector2::Phi_mpi_pi(HCSV_reg_phi-met_phi)) met_pt (Jet_eta[hJCidx[0]]-Jet_eta[hJCidx[1]]) Jet_btagCSV[hJCidx[0]] Jet_btagCSV[hJCidx[1]] softActivityVH_njets5 TVector2::Phi_mpi_pi(Jet_phi[hJCidx[0]]-Jet_phi[hJCidx[1]]) max(Jet_pt_reg[hJCidx[0]],Jet_pt_reg[hJCidx[1]]) min(Jet_pt_reg[hJCidx[0]],Jet_pt_reg[hJCidx[1]]) Max$(Jet_btagCSV[aJCidx]) Max$(Jet_pt_reg[aJCidx]) MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi))-3.1415,Jet_pt_reg>30&&Jet_puId>=4)

JER_Up_HighCentral = HCSV_reg_corrJERUp_mass_HighCentral HCSV_reg_corrJERUp_pt_HighCentral abs(TVector2::Phi_mpi_pi(HCSV_reg_corrJERUp_phi_HighCentral-met_phi)) met_pt (Jet_eta[hJCidx[0]]-Jet_eta[hJCidx[1]]) Jet_btagCSV[hJCidx[0]] Jet_btagCSV[hJCidx[1]] softActivityVH_njets5 TVector2::Phi_mpi_pi(Jet_phi[hJCidx[0]]-Jet_phi[hJCidx[1]]) max(Jet_pt_reg_corrJERUp_HighCentral[hJCidx[0]],Jet_pt_reg_corrJERUp_HighCentral[hJCidx[1]]) min(Jet_pt_reg_corrJERUp_HighCentral[hJCidx[0]],Jet_pt_reg_corrJERUp_HighCentral[hJCidx[1]]) Max$(Jet_btagCSV[aJCidx]) Max$(Jet_pt_reg_corrJERUp_HighCentral[aJCidx]) MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi))-3.1415,Jet_pt_reg_corrJERUp_HighCentral>30&&Jet_puId>=4)

JER_Up_HighForward = HCSV_reg_corrJERUp_mass_HighForward HCSV_reg_corrJERUp_pt_HighForward abs(TVector2::Phi_mpi_pi(HCSV_reg_corrJERUp_phi_HighForward-met_phi)) met_pt (Jet_eta[hJCidx[0]]-Jet_eta[hJCidx[1]]) Jet_btagCSV[hJCidx[0]] Jet_btagCSV[hJCidx[1]] softActivityVH_njets5 TVector2::Phi_mpi_pi(Jet_phi[hJCidx[0]]-Jet_phi[hJCidx[1]]) max(Jet_pt_reg_corrJERUp_HighForward[hJCidx[0]],Jet_pt_reg_corrJERUp_HighForward[hJCidx[1]]) min(Jet_pt_reg_corrJERUp_HighForward[hJCidx[0]],Jet_pt_reg_corrJERUp_HighForward[hJCidx[1]]) Max$(Jet_btagCSV[aJCidx]) Max$(Jet_pt_reg_corrJERUp_HighForward[aJCidx]) MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi))-3.1415,Jet_pt_reg_corrJERUp_HighForward>30&&Jet_puId>=4)

JER_Up_LowCentral = HCSV_reg_corrJERUp_mass_LowCentral HCSV_reg_corrJERUp_pt_LowCentral abs(TVector2::Phi_mpi_pi(HCSV_reg_corrJERUp_phi_LowCentral-met_phi)) met_pt (Jet_eta[hJCidx[0]]-Jet_eta[hJCidx[1]]) Jet_btagCSV[hJCidx[0]] Jet_btagCSV[hJCidx[1]] softActivityVH_njets5 TVector2::Phi_mpi_pi(Jet_phi[hJCidx[0]]-Jet_phi[hJCidx[1]]) max(Jet_pt_reg_corrJERUp_LowCentral[hJCidx[0]],Jet_pt_reg_corrJERUp_LowCentral[hJCidx[1]]) min(Jet_pt_reg_corrJERUp_LowCentral[hJCidx[0]],Jet_pt_reg_corrJERUp_LowCentral[hJCidx[1]]) Max$(Jet_btagCSV[aJCidx]) Max$(Jet_pt_reg_corrJERUp_LowCentral[aJCidx]) MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi))-3.1415,Jet_pt_reg_corrJERUp_LowCentral>30&&Jet_puId>=4)

JER_Up_LowForward = HCSV_reg_corrJERUp_mass_LowForward HCSV_reg_corrJERUp_pt_LowForward abs(TVector2::Phi_mpi_pi(HCSV_reg_corrJERUp_phi_LowForward-met_phi)) met_pt (Jet_eta[hJCidx[0]]-Jet_eta[hJCidx[1]]) Jet_btagCSV[hJCidx[0]] Jet_btagCSV[hJCidx[1]] softActivityVH_njets5 TVector2::Phi_mpi_pi(Jet_phi[hJCidx[0]]-Jet_phi[hJCidx[1]]) max(Jet_pt_reg_corrJERUp_LowForward[hJCidx[0]],Jet_pt_reg_corrJERUp_LowForward[hJCidx[1]]) min(Jet_pt_reg_corrJERUp_LowForward[hJCidx[0]],Jet_pt_reg_corrJERUp_LowForward[hJCidx[1]]) Max$(Jet_btagCSV[aJCidx]) Max$(Jet_pt_reg_corrJERUp_LowForward[aJCidx]) MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi))-3.1415,Jet_pt_reg_corrJERUp_LowForward>30&&Jet_puId>=4)

JER_Down_HighCentral = HCSV_reg_corrJERDown_mass_HighCentral HCSV_reg_corrJERDown_pt_HighCentral abs(TVector2::Phi_mpi_pi(HCSV_reg_corrJERDown_phi_HighCentral-met_phi)) met_pt (Jet_eta[hJCidx[0]]-Jet_eta[hJCidx[1]]) Jet_btagCSV[hJCidx[0]] Jet_btagCSV[hJCidx[1]] softActivityVH_njets5 TVector2::Phi_mpi_pi(Jet_phi[hJCidx[0]]-Jet_phi[hJCidx[1]]) max(Jet_pt_reg_corrJERDown_HighCentral[hJCidx[0]],Jet_pt_reg_corrJERDown_HighCentral[hJCidx[1]]) min(Jet_pt_reg_corrJERDown_HighCentral[hJCidx[0]],Jet_pt_reg_corrJERDown_HighCentral[hJCidx[1]]) Max$(Jet_btagCSV[aJCidx]) Max$(Jet_pt_reg_corrJERDown_HighCentral[aJCidx]) MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi))-3.1415,Jet_pt_reg_corrJERDown_HighCentral>30&&Jet_puId>=4)

JER_Down_HighForward = HCSV_reg_corrJERDown_mass_HighForward HCSV_reg_corrJERDown_pt_HighForward abs(TVector2::Phi_mpi_pi(HCSV_reg_corrJERDown_phi_HighForward-met_phi)) met_pt (Jet_eta[hJCidx[0]]-Jet_eta[hJCidx[1]]) Jet_btagCSV[hJCidx[0]] Jet_btagCSV[hJCidx[1]] softActivityVH_njets5 TVector2::Phi_mpi_pi(Jet_phi[hJCidx[0]]-Jet_phi[hJCidx[1]]) max(Jet_pt_reg_corrJERDown_HighForward[hJCidx[0]],Jet_pt_reg_corrJERDown_HighForward[hJCidx[1]]) min(Jet_pt_reg_corrJERDown_HighForward[hJCidx[0]],Jet_pt_reg_corrJERDown_HighForward[hJCidx[1]]) Max$(Jet_btagCSV[aJCidx]) Max$(Jet_pt_reg_corrJERDown_HighForward[aJCidx]) MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi))-3.1415,Jet_pt_reg_corrJERDown_HighForward>30&&Jet_puId>=4)

JER_Down_LowCentral = HCSV_reg_corrJERDown_mass_LowCentral HCSV_reg_corrJERDown_pt_LowCentral abs(TVector2::Phi_mpi_pi(HCSV_reg_corrJERDown_phi_LowCentral-met_phi)) met_pt (Jet_eta[hJCidx[0]]-Jet_eta[hJCidx[1]]) Jet_btagCSV[hJCidx[0]] Jet_btagCSV[hJCidx[1]] softActivityVH_njets5 TVector2::Phi_mpi_pi(Jet_phi[hJCidx[0]]-Jet_phi[hJCidx[1]]) max(Jet_pt_reg_corrJERDown_LowCentral[hJCidx[0]],Jet_pt_reg_corrJERDown_LowCentral[hJCidx[1]]) min(Jet_pt_reg_corrJERDown_LowCentral[hJCidx[0]],Jet_pt_reg_corrJERDown_LowCentral[hJCidx[1]]) Max$(Jet_btagCSV[aJCidx]) Max$(Jet_pt_reg_corrJERDown_LowCentral[aJCidx]) MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi))-3.1415,Jet_pt_reg_corrJERDown_LowCentral>30&&Jet_puId>=4)

JER_Down_LowForward = HCSV_reg_corrJERDown_mass_LowForward HCSV_reg_corrJERDown_pt_LowForward abs(TVector2::Phi_mpi_pi(HCSV_reg_corrJERDown_phi_LowForward-met_phi)) met_pt (Jet_eta[hJCidx[0]]-Jet_eta[hJCidx[1]]) Jet_btagCSV[hJCidx[0]] Jet_btagCSV[hJCidx[1]] softActivityVH_njets5 TVector2::Phi_mpi_pi(Jet_phi[hJCidx[0]]-Jet_phi[hJCidx[1]]) max(Jet_pt_reg_corrJERDown_LowForward[hJCidx[0]],Jet_pt_reg_corrJERDown_LowForward[hJCidx[1]]) min(Jet_pt_reg_corrJERDown_LowForward[hJCidx[0]],Jet_pt_reg_corrJERDown_LowForward[hJCidx[1]]) Max$(Jet_btagCSV[aJCidx]) Max$(Jet_pt_reg_corrJERDown_LowForward[aJCidx]) MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi))-3.1415,Jet_pt_reg_corrJERDown_LowForward>30&&Jet_puId>=4)

JEC_Up_HighCentral = HCSV_reg_corrJECUp_mass_HighCentral HCSV_reg_corrJECUp_pt_HighCentral abs(TVector2::Phi_mpi_pi(HCSV_reg_corrJECUp_phi_HighCentral-met_phi)) met_pt (Jet_eta[hJCidx[0]]-Jet_eta[hJCidx[1]]) Jet_btagCSV[hJCidx[0]] Jet_btagCSV[hJCidx[1]] softActivityVH_njets5 TVector2::Phi_mpi_pi(Jet_phi[hJCidx[0]]-Jet_phi[hJCidx[1]]) max(Jet_pt_reg_corrJECUp_HighCentral[hJCidx[0]],Jet_pt_reg_corrJECUp_HighCentral[hJCidx[1]]) min(Jet_pt_reg_corrJECUp_HighCentral[hJCidx[0]],Jet_pt_reg_corrJECUp_HighCentral[hJCidx[1]]) Max$(Jet_btagCSV[aJCidx]) Max$(Jet_pt_reg_corrJECUp_HighCentral[aJCidx]) MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi))-3.1415,Jet_pt_reg_corrJECUp_HighCentral>30&&Jet_puId>=4)

JEC_Up_HighForward = HCSV_reg_corrJECUp_mass_HighForward HCSV_reg_corrJECUp_pt_HighForward abs(TVector2::Phi_mpi_pi(HCSV_reg_corrJECUp_phi_HighForward-met_phi)) met_pt (Jet_eta[hJCidx[0]]-Jet_eta[hJCidx[1]]) Jet_btagCSV[hJCidx[0]] Jet_btagCSV[hJCidx[1]] softActivityVH_njets5 TVector2::Phi_mpi_pi(Jet_phi[hJCidx[0]]-Jet_phi[hJCidx[1]]) max(Jet_pt_reg_corrJECUp_HighForward[hJCidx[0]],Jet_pt_reg_corrJECUp_HighForward[hJCidx[1]]) min(Jet_pt_reg_corrJECUp_HighForward[hJCidx[0]],Jet_pt_reg_corrJECUp_HighForward[hJCidx[1]]) Max$(Jet_btagCSV[aJCidx]) Max$(Jet_pt_reg_corrJECUp_HighForward[aJCidx]) MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi))-3.1415,Jet_pt_reg_corrJECUp_HighForward>30&&Jet_puId>=4)

JEC_Up_LowCentral = HCSV_reg_corrJECUp_mass_LowCentral HCSV_reg_corrJECUp_pt_LowCentral abs(TVector2::Phi_mpi_pi(HCSV_reg_corrJECUp_phi_LowCentral-met_phi)) met_pt (Jet_eta[hJCidx[0]]-Jet_eta[hJCidx[1]]) Jet_btagCSV[hJCidx[0]] Jet_btagCSV[hJCidx[1]] softActivityVH_njets5 TVector2::Phi_mpi_pi(Jet_phi[hJCidx[0]]-Jet_phi[hJCidx[1]]) max(Jet_pt_reg_corrJECUp_LowCentral[hJCidx[0]],Jet_pt_reg_corrJECUp_LowCentral[hJCidx[1]]) min(Jet_pt_reg_corrJECUp_LowCentral[hJCidx[0]],Jet_pt_reg_corrJECUp_LowCentral[hJCidx[1]]) Max$(Jet_btagCSV[aJCidx]) Max$(Jet_pt_reg_corrJECUp_LowCentral[aJCidx]) MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi))-3.1415,Jet_pt_reg_corrJECUp_LowCentral>30&&Jet_puId>=4)

JEC_Up_LowForward = HCSV_reg_corrJECUp_mass_LowForward HCSV_reg_corrJECUp_pt_LowForward abs(TVector2::Phi_mpi_pi(HCSV_reg_corrJECUp_phi_LowForward-met_phi)) met_pt (Jet_eta[hJCidx[0]]-Jet_eta[hJCidx[1]]) Jet_btagCSV[hJCidx[0]] Jet_btagCSV[hJCidx[1]] softActivityVH_njets5 TVector2::Phi_mpi_pi(Jet_phi[hJCidx[0]]-Jet_phi[hJCidx[1]]) max(Jet_pt_reg_corrJECUp_LowForward[hJCidx[0]],Jet_pt_reg_corrJECUp_LowForward[hJCidx[1]]) min(Jet_pt_reg_corrJECUp_LowForward[hJCidx[0]],Jet_pt_reg_corrJECUp_LowForward[hJCidx[1]]) Max$(Jet_btagCSV[aJCidx]) Max$(Jet_pt_reg_corrJECUp_LowForward[aJCidx]) MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi))-3.1415,Jet_pt_reg_corrJECUp_LowForward>30&&Jet_puId>=4)

JEC_Down_HighCentral = HCSV_reg_corrJECDown_mass_HighCentral HCSV_reg_corrJECDown_pt_HighCentral abs(TVector2::Phi_mpi_pi(HCSV_reg_corrJECDown_phi_HighCentral-met_phi)) met_pt (Jet_eta[hJCidx[0]]-Jet_eta[hJCidx[1]]) Jet_btagCSV[hJCidx[0]] Jet_btagCSV[hJCidx[1]] softActivityVH_njets5 TVector2::Phi_mpi_pi(Jet_phi[hJCidx[0]]-Jet_phi[hJCidx[1]]) max(Jet_pt_reg_corrJECDown_HighCentral[hJCidx[0]],Jet_pt_reg_corrJECDown_HighCentral[hJCidx[1]]) min(Jet_pt_reg_corrJECDown_HighCentral[hJCidx[0]],Jet_pt_reg_corrJECDown_HighCentral[hJCidx[1]]) Max$(Jet_btagCSV[aJCidx]) Max$(Jet_pt_reg_corrJECDown_HighCentral[aJCidx]) MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi))-3.1415,Jet_pt_reg_corrJECDown_HighCentral>30&&Jet_puId>=4)

JEC_Down_HighForward = HCSV_reg_corrJECDown_mass_HighForward HCSV_reg_corrJECDown_pt_HighForward abs(TVector2::Phi_mpi_pi(HCSV_reg_corrJECDown_phi_HighForward-met_phi)) met_pt (Jet_eta[hJCidx[0]]-Jet_eta[hJCidx[1]]) Jet_btagCSV[hJCidx[0]] Jet_btagCSV[hJCidx[1]] softActivityVH_njets5 TVector2::Phi_mpi_pi(Jet_phi[hJCidx[0]]-Jet_phi[hJCidx[1]]) max(Jet_pt_reg_corrJECDown_HighForward[hJCidx[0]],Jet_pt_reg_corrJECDown_HighForward[hJCidx[1]]) min(Jet_pt_reg_corrJECDown_HighForward[hJCidx[0]],Jet_pt_reg_corrJECDown_HighForward[hJCidx[1]]) Max$(Jet_btagCSV[aJCidx]) Max$(Jet_pt_reg_corrJECDown_HighForward[aJCidx]) MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi))-3.1415,Jet_pt_reg_corrJECDown_HighForward>30&&Jet_puId>=4)

JEC_Down_LowCentral = HCSV_reg_corrJECDown_mass_LowCentral HCSV_reg_corrJECDown_pt_LowCentral abs(TVector2::Phi_mpi_pi(HCSV_reg_corrJECDown_phi_LowCentral-met_phi)) met_pt (Jet_eta[hJCidx[0]]-Jet_eta[hJCidx[1]]) Jet_btagCSV[hJCidx[0]] Jet_btagCSV[hJCidx[1]] softActivityVH_njets5 TVector2::Phi_mpi_pi(Jet_phi[hJCidx[0]]-Jet_phi[hJCidx[1]]) max(Jet_pt_reg_corrJECDown_LowCentral[hJCidx[0]],Jet_pt_reg_corrJECDown_LowCentral[hJCidx[1]]) min(Jet_pt_reg_corrJECDown_LowCentral[hJCidx[0]],Jet_pt_reg_corrJECDown_LowCentral[hJCidx[1]]) Max$(Jet_btagCSV[aJCidx]) Max$(Jet_pt_reg_corrJECDown_LowCentral[aJCidx]) MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi))-3.1415,Jet_pt_reg_corrJECDown_LowCentral>30&&Jet_puId>=4)

JEC_Down_LowForward = HCSV_reg_corrJECDown_mass_LowForward HCSV_reg_corrJECDown_pt_LowForward abs(TVector2::Phi_mpi_pi(HCSV_reg_corrJECDown_phi_LowForward-met_phi)) met_pt (Jet_eta[hJCidx[0]]-Jet_eta[hJCidx[1]]) Jet_btagCSV[hJCidx[0]] Jet_btagCSV[hJCidx[1]] softActivityVH_njets5 TVector2::Phi_mpi_pi(Jet_phi[hJCidx[0]]-Jet_phi[hJCidx[1]]) max(Jet_pt_reg_corrJECDown_LowForward[hJCidx[0]],Jet_pt_reg_corrJECDown_LowForward[hJCidx[1]]) min(Jet_pt_reg_corrJECDown_LowForward[hJCidx[0]],Jet_pt_reg_corrJECDown_LowForward[hJCidx[1]]) Max$(Jet_btagCSV[aJCidx]) Max$(Jet_pt_reg_corrJECDown_LowForward[aJCidx]) MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi))-3.1415,Jet_pt_reg_corrJECDown_LowForward>30&&Jet_puId>=4)

#-------------------------------------------------
# BDT Classifiers
[BDT_Diboson_HighPt]
MVAtype     = <!MVAGeneral|type!>
MVAsettings = <!MVAGeneral|settings!>
signals     = [<!Samples|Signal!>]
backgrounds = [<!Samples|allBKG!>] 
treeVarSet  = ZvvBDTVars
treeCut     = HighPt_Signal

#-------------------------------------------------
# Classifiers to Evaluate
[MVALists]
List_for_submitscript = BDT_Diboson_HighPt

#-------------------------------------------------
[Optimisation]
training = RTight_ZH125_janAngularOnly
parameters = NTrees,nEventsMin,MaxDepth,BoostType,AdaBoostBeta,SeparationType,nCuts,PruneMethod,PruneStrength,GradBaggingFraction,Shrinkage,UseBaggedGrad,UseRandomisedTrees,UseNvars

;Var= min max number_of steps. number_of_steps is 0 for only min, 1 for min and max, etc...
NTrees = [100,200,10]
nEventsMin = [50,600,0]
MaxDepth = [4,5,0]
BoostType = ['AdaBoost']
AdaBoostBeta = [0.01,0.2,10]
SeparationType = ['MisClassificationError']
nCuts = [25,150,0]
PruneMethod = ['NoPruning']
PruneStrength = [50]
GradBaggingFraction = [1.0]
Shrinkage = [0.1]
UseBaggedGrad = ['True']
UseRandomisedTrees = ['False']
UseNvars = [30]

