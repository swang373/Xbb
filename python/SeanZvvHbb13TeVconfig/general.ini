[General]
# The target luminosity for the samples in pb-1.
lumi = 22021
# Set to True or False to display debug messages.
Debug = True

[Analysis]
tag = 13TeV
RedoPreselection = False

# If TrainFlag is True, half of each MC sample will be for
# training while the rest will be scaled by a factor of two.
# CAUTION! If TrainFlag is True during training but False when preparing
# the datacards, the training samples will be included and bias the limit.
TrainFlag = False

# Current BDT FOM: Cls of train/vs CLs of test sample. To produce the DC on train sample, set this flag to True.
# !!!IMPORTANT: BE SURE TO HAVE "UseTrainSample = False" WHEN COMPUTING THE FINAL LIMIT !!!
UseTrainSample = False

[systematics]
systematics = Nominal JER_up JER_down JES_up JES_down

#-------------------------------------------------
# Compiled Libraries

[VHbbNameSpace]
library = <!Directories|vhbbpath!>/interface/VHbbNameSpace_h.so

[BTagReshaping]
library = <!Directories|vhbbpath!>/interface/BTagReshaping_h.so

#-------------------------------------------------
[Samples]

#-- Signal Samples --#
ZH      = 'ZH'
WminusH = 'WminusH'
WplusH  = 'WplusH'
ggZH    = 'ggZH'

Signal = <!Samples|ZH!>, <!Samples|WminusH!>, <!Samples|WplusH!>, <!Samples|ggZH!>

#-- W+Jets Samples --#
WJetsHT0    = 'WJetsHT0_light', 'WJetsHT0_1b', 'WJetsHT0_2b'
WJetsHT100  = 'WJetsHT100_light', 'WJetsHT100_1b', 'WJetsHT100_2b'
WJetsHT200  = 'WJetsHT200_light', 'WJetsHT200_1b', 'WJetsHT200_2b'
WJetsHT400  = 'WJetsHT400_light', 'WJetsHT400_1b', 'WJetsHT400_2b'
WJetsHT600  = 'WJetsHT600_light', 'WJetsHT600_1b', 'WJetsHT600_2b'
WJetsHT800  = 'WJetsHT800_light', 'WJetsHT800_1b', 'WJetsHT800_2b'
WJetsHT1200 = 'WJetsHT1200_light', 'WJetsHT1200_1b', 'WJetsHT1200_2b'
WJetsHT2500 = 'WJetsHT2500_light', 'WJetsHT2500_1b', 'WJetsHT2500_2b'

WJets = <!Samples|WJetsHT0!>, <!Samples|WJetsHT100!>, <!Samples|WJetsHT200!>, <!Samples|WJetsHT400!>, <!Samples|WJetsHT600!>, <!Samples|WJetsHT800!>, <!Samples|WJetsHT1200!>, <!Samples|WJetsHT2500!>

#-- Z+Jets Samples --#
ZJetsHT100  = 'ZJetsHT100_light', 'ZJetsHT100_1b', 'ZJetsHT100_2b'
ZJetsHT200  = 'ZJetsHT200_light', 'ZJetsHT200_1b', 'ZJetsHT200_2b'
ZJetsHT400  = 'ZJetsHT400_light', 'ZJetsHT400_1b', 'ZJetsHT400_2b'
ZJetsHT600  = 'ZJetsHT600_light', 'ZJetsHT600_1b', 'ZJetsHT600_2b'
ZJetsHT800  = 'ZJetsHT800_light', 'ZJetsHT800_1b', 'ZJetsHT800_2b'
ZJetsHT1200 = 'ZJetsHT1200_light', 'ZJetsHT1200_1b', 'ZJetsHT1200_2b'
ZJetsHT2500 = 'ZJetsHT2500_light', 'ZJetsHT2500_1b', 'ZJetsHT2500_2b'

ZJets = <!Samples|ZJetsHT100!>, <!Samples|ZJetsHT200!>, <!Samples|ZJetsHT400!>, <!Samples|ZJetsHT600!>, <!Samples|ZJetsHT800!>, <!Samples|ZJetsHT1200!>, <!Samples|ZJetsHT2500!>

#-- TTbar Samples --#
TT = 'TT'

#-- Single Top Samples --#
ST = 'ST_s', 'ST_t_antitop', 'ST_t_top', 'ST_tW_antitop', 'ST_tW_top'

#-- QCD Samples --#
QCD = 'QCDHT100', 'QCDHT200', 'QCDHT300', 'QCDHT500', 'QCDHT700', 'QCDHT1000', 'QCDHT1500', 'QCDHT2000'

#-- Diboson Samples --#
WWLF = 'WW_light'
WZLF = 'WZ_light'
ZZLF = 'ZZ_light'

WWHF = 'WW_1b', 'WW_2b'
WZHF = 'WZ_1b', 'WZ_2b'
ZZHF = 'ZZ_1b', 'ZZ_2b'

VVLF = <!Samples|WWLF!>, <!Samples|WZLF!>, <!Samples|ZZLF!>
VVHF = <!Samples|WWHF!>, <!Samples|WZHF!>, <!Samples|ZZHF!>

VV = <!Samples|VVLF!>, <!Samples|VVHF!>

# Background Samples
allBKG = <!Samples|VV!>, <!Samples|ZJets!>, <!Samples|WJets!>, <!Samples|TT!>, <!Samples|ST!>, <!Samples|QCD!>

# Dictionary of sample groups.
# What in the world does this even do?
setup = VH, VV, ZJets_0b, ZJets_1b, ZJets_2b, WJets_0b, WJets_1b, WJets_2b, TT, ST, QCD
setupLog = <!Samples|setup!>

Group = {
    'ZH': 'ZH',
	'ggZH': 'ggZH',
    'WminusH': 'WH',
	'WplusH': 'WH',
	'WJetsHT0_light':    'WJets_0b', 'WJetsHT0_1b':    'WJets_1b', 'WJetsHT0_2b':    'WJets_2b',
	'WJetsHT100_light':  'WJets_0b', 'WJetsHT100_1b':  'WJets_1b', 'WJetsHT100_2b':  'WJets_2b',
	'WJetsHT200_light':  'WJets_0b', 'WJetsHT200_1b':  'WJets_1b', 'WJetsHT200_2b':  'WJets_2b',
	'WJetsHT400_light':  'WJets_0b', 'WJetsHT400_1b':  'WJets_1b', 'WJetsHT400_2b':  'WJets_2b',
	'WJetsHT600_light':  'WJets_0b', 'WJetsHT600_1b':  'WJets_1b', 'WJetsHT600_2b':  'WJets_2b',
	'WJetsHT800_light':  'WJets_0b', 'WJetsHT800_1b':  'WJets_1b', 'WJetsHT800_2b':  'WJets_2b',
	'WJetsHT1200_light': 'WJets_0b', 'WJetsHT1200_1b': 'WJets_1b', 'WJetsHT1200_2b': 'WJets_2b',
	'WJetsHT2500_light': 'WJets_0b', 'WJetsHT2500_1b': 'WJets_1b', 'WJetsHT2500_2b': 'WJets_2b',
    'ZJetsHT100_light':  'ZJets_0b', 'ZJetsHT100_1b':  'ZJets_1b', 'ZJetsHT100_2b':  'ZJets_2b',
	'ZJetsHT200_light':  'ZJets_0b', 'ZJetsHT200_1b':  'ZJets_1b', 'ZJetsHT200_2b':  'ZJets_2b',
	'ZJetsHT400_light':  'ZJets_0b', 'ZJetsHT400_1b':  'ZJets_1b', 'ZJetsHT400_2b':  'ZJets_2b',
	'ZJetsHT600_light':  'ZJets_0b', 'ZJetsHT600_1b':  'ZJets_1b', 'ZJetsHT600_2b':  'ZJets_2b',
	'ZJetsHT800_light':  'ZJets_0b', 'ZJetsHT800_1b':  'ZJets_1b', 'ZJetsHT800_2b':  'ZJets_2b',
	'ZJetsHT1200_light': 'ZJets_0b', 'ZJetsHT1200_1b': 'ZJets_1b', 'ZJetsHT1200_2b': 'ZJets_2b',
	'ZJetsHT2500_light': 'ZJets_0b', 'ZJetsHT2500_1b': 'ZJets_1b', 'ZJetsHT2500_2b': 'ZJets_2b',
    'TT': 'TT',
    'ST_s': 'ST',
	'ST_t_antitop': 'ST',
	'ST_t_top': 'ST',
	'ST_tW_antitop': 'ST',
	'ST_tW_top': 'ST',
    'QCDHT100': 'QCD',
	'QCDHT200': 'QCD',
	'QCDHT300': 'QCD',
	'QCDHT500': 'QCD',
	'QCDHT700': 'QCD',
	'QCDHT1000': 'QCD',
	'QCDHT1500': 'QCD',
	'QCDHT2000': 'QCD',
	'WW_light': 'VVLF', 'WW_1b': 'VVHF', 'WW_2b': 'VVHF',
 	'WZ_light': 'VVLF', 'WZ_1b': 'VVHF', 'WZ_2b': 'VVHF',
 	'ZZ_light': 'VVLF', 'ZZ_1b': 'VVHF', 'ZZ_2b': 'VVHF', 
	'MET_Run2016B': 'DATA',
	'MET_Run2016C': 'DATA',
	'MET_Run2016D': 'DATA',
    'MET_Run2016E': 'DATA',
	'MET_Run2016F': 'DATA',
	'MET_Run2016G': 'DATA',
    }

#-------------------------------------------------
# Weight Expressions

[Weights]

Common     = sign(genWeight)
PUWeight   = puWeight
BTagWeight = btagWeightCSV
QCDEWKWeight  = (nGenHiggsBoson>0||nGenTop>0 ? 1 : VHbb::ptWeightQCD(nGenVbosons,lheHT,Alt$(GenVbosons_pdgId[0],0)) * VHbb::ptWeightEWK(nGenVbosons,Alt$(GenVbosons_pt[0],0), VtypeSim, Alt$(GenVbosons_pdgId[0],0)))

# From Michele for 2016. The trigger expression is
# HLT_BIT_HLT_PFMET110_PFMHT110_IDTight_v || HLT_BIT_HLT_PFMET120_PFMHT120_IDTight_v || 
# HLT_BIT_HLT_PFMET170_NoiseCleaned_v || HLT_BIT_HLT_PFMET170_HBHE_BeamHaloCleaned_v || HLT_BIT_HLT_PFMET170_HBHECleaned_v
triggerWeight     = VHbb::triggerMET(min(met_pt,mhtJet30))
triggerWeightUp   = VHbb::triggerMET(min(met_pt,mhtJet30))
triggerWeightDown = VHbb::triggerMET(min(met_pt,mhtJet30))

weightF = <!Weights|Common!> * <!Weights|PUWeight!> * <!Weights|BTagWeight!> * <!Weights|triggerWeight!> * <!Weights|QCDEWKWeight!>

weightF_bTagHF_UP       = <!Weights|Common!> * <!Weights|triggerWeight!> * <!Weights|PUWeight!> * btagWeightCSV_up_hf
weightF_bTagLF_UP       = <!Weights|Common!> * <!Weights|triggerWeight!> * <!Weights|PUWeight!> * btagWeightCSV_up_lf
weightF_bTagHFStats1_UP = <!Weights|Common!> * <!Weights|triggerWeight!> * <!Weights|PUWeight!> * btagWeightCSV_up_hfstats1
weightF_bTagHFStats2_UP = <!Weights|Common!> * <!Weights|triggerWeight!> * <!Weights|PUWeight!> * btagWeightCSV_up_hfstats2
weightF_bTagLFStats1_UP = <!Weights|Common!> * <!Weights|triggerWeight!> * <!Weights|PUWeight!> * btagWeightCSV_up_lfstats1
weightF_bTagLFStats2_UP = <!Weights|Common!> * <!Weights|triggerWeight!> * <!Weights|PUWeight!> * btagWeightCSV_up_lfstats2
weightF_bTagcErr1_UP    = <!Weights|Common!> * <!Weights|triggerWeight!> * <!Weights|PUWeight!> * btagWeightCSV_up_cferr1
weightF_bTagcErr2_UP    = <!Weights|Common!> * <!Weights|triggerWeight!> * <!Weights|PUWeight!> * btagWeightCSV_up_cferr2

weightF_bTagHF_DOWN       =  <!Weights|Common!> * <!Weights|triggerWeight!> * <!Weights|PUWeight!> * btagWeightCSV_down_hf
weightF_bTagLF_DOWN       =  <!Weights|Common!> * <!Weights|triggerWeight!> * <!Weights|PUWeight!> * btagWeightCSV_down_lf
weightF_bTagHFStats1_DOWN =  <!Weights|Common!> * <!Weights|triggerWeight!> * <!Weights|PUWeight!> * btagWeightCSV_down_hfstats1
weightF_bTagHFStats2_DOWN =  <!Weights|Common!> * <!Weights|triggerWeight!> * <!Weights|PUWeight!> * btagWeightCSV_down_hfstats2
weightF_bTagLFStats1_DOWN =  <!Weights|Common!> * <!Weights|triggerWeight!> * <!Weights|PUWeight!> * btagWeightCSV_down_lfstats1
weightF_bTagLFStats2_DOWN =  <!Weights|Common!> * <!Weights|triggerWeight!> * <!Weights|PUWeight!> * btagWeightCSV_down_lfstats2
weightF_bTagcErr1_DOWN    =  <!Weights|Common!> * <!Weights|triggerWeight!> * <!Weights|PUWeight!> * btagWeightCSV_down_cferr1
weightF_bTagcErr2_DOWN    =  <!Weights|Common!> * <!Weights|triggerWeight!> * <!Weights|PUWeight!> * btagWeightCSV_down_cferr2

weightF_bTagJES_UP   = <!Weights|Common!> * <!Weights|triggerWeight!> * <!Weights|PUWeight!> * btagWeightCSV_up_jes
weightF_bTagJES_DOWN = <!Weights|Common!> * <!Weights|triggerWeight!> * <!Weights|PUWeight!> * btagWeightCSV_down_jes

weightF_pileUp_UP   = <!Weights|Common!> * <!Weights|triggerWeight!> * puWeightUp * <!Weights|BTagWeight!>
weightF_pileUp_DOWN = <!Weights|Common!> * <!Weights|triggerWeight!> * puWeightDown * <!Weights|BTagWeight!>

weightF_triggerMET_UP   = <!Weights|Common!> * <!Weights|triggerWeightUp!> * <!Weights|PUWeight!> * <!Weights|BTagWeight!>
weightF_triggerMET_DOWN = <!Weights|Common!> * <!Weights|triggerWeightDown!> * <!Weights|PUWeight!> * <!Weights|BTagWeight!>

#-------------------------------------------------
# Unknown or Superfluous Sections

[BTagHFweights]
file = <!Directories|vhbbpath!>/python/weights/csv_rwt_fit_hf_76x_2016_02_08.root

[BTagLFweights]
file = <!Directories|vhbbpath!>/python/weights/csv_rwt_fit_lf_76x_2016_02_08.root

[AngularLike]
backgrounds = ['Zbb','Zudsg','ttbar','ZZ']
yields = {'Zbb':584.8,'Zudsg':881.61,'ttbar':135.7,'ZZ':44.04,'Sig':5.13}

[Regression]

# New variables to add to the tree.
writeNewVariables = {
    'CSV3':'Max$(Jet_btagCSV[aJCidx])',\
    'naddGoodLeptons5':'Sum$(aLeptons_pt>5 && (aLeptons_jetBTagCSV<0.25 || aLeptons_relIso03<0.4 || aLeptons_looseIdSusy!=0 ||  aLeptons_jetDR>0.3 ))+Sum$(vLeptons_pt>5 && (vLeptons_jetBTagCSV<0.25 || vLeptons_relIso03<0.4 || vLeptons_looseIdSusy!=0 ||  vLeptons_jetDR>0.3 ))',\
    'naddGoodLeptons7':'Sum$(aLeptons_pt>7 && (aLeptons_jetBTagCSV<0.25 || aLeptons_relIso03<0.4 || aLeptons_looseIdSusy!=0 ||  aLeptons_jetDR>0.3 ))+Sum$(vLeptons_pt>7 && (vLeptons_jetBTagCSV<0.25 || vLeptons_relIso03<0.4 || vLeptons_looseIdSusy!=0 ||  vLeptons_jetDR>0.3 ))',\
    'naddGoodLeptons10':'Sum$(aLeptons_pt>10 && (aLeptons_jetBTagCSV<0.25 || aLeptons_relIso03<0.4 || aLeptons_looseIdSusy!=0 ||  aLeptons_jetDR>0.3 ))+Sum$(vLeptons_pt>10 && (vLeptons_jetBTagCSV<0.25 || vLeptons_relIso03<0.4 || vLeptons_looseIdSusy!=0 ||  vLeptons_jetDR>0.3 ))',\
    'naddGoodLeptons15':'Sum$(aLeptons_pt>15 && (aLeptons_jetBTagCSV<0.25 || aLeptons_relIso03<0.4 || aLeptons_looseIdSusy!=0 ||  aLeptons_jetDR>0.3 ))+Sum$(vLeptons_pt>15 && (vLeptons_jetBTagCSV<0.25 || vLeptons_relIso03<0.4 || vLeptons_looseIdSusy!=0 ||  vLeptons_jetDR>0.3 ))',\
    'naddGoodLeptons20':'Sum$(aLeptons_pt>20 && (aLeptons_jetBTagCSV<0.25 || aLeptons_relIso03<0.4 || aLeptons_looseIdSusy!=0 ||  aLeptons_jetDR>0.3 ))+Sum$(vLeptons_pt>20 && (vLeptons_jetBTagCSV<0.25 || vLeptons_relIso03<0.4 || vLeptons_looseIdSusy!=0 ||  vLeptons_jetDR>0.3 ))',\
    'addLepton5':'Sum$(aLeptons_pt>5&&abs(aLeptons_eta)<5.2)+Sum$(vLeptons_pt>5&&abs(vLeptons_eta)<5.2)',\
    'addLepton10':'Sum$(aLeptons_pt>10&&abs(aLeptons_eta)<5.2)+Sum$(vLeptons_pt>10&&abs(vLeptons_eta)<5.2)',\
    'addLepton20':'Sum$(aLeptons_pt>20&&abs(aLeptons_eta)<5.2)+Sum$(vLeptons_pt>20&&abs(vLeptons_eta)<5.2)',\
    'addLepton30':'Sum$(aLeptons_pt>30&&abs(aLeptons_eta)<5.2)+Sum$(vLeptons_pt>30&&abs(vLeptons_eta)<5.2)',\
    'addJet20':'Sum$(Jet_pt[aJCidx]>20. && abs(Jet_eta[aJCidx])<5.2)',\
    'addJetNoPU20':'Sum$(Jet_pt[aJCidx]>20. && abs(Jet_eta[aJCidx])<5.2 && Jet_puId[aJCidx]>0)',\
    'addCenJet20':'Sum$(Jet_pt[aJCidx]>20. && abs(Jet_eta[aJCidx])<2.4)',\
    'addCenJetNoPU20':'Sum$(Jet_pt[aJCidx]>20. && abs(Jet_eta[aJCidx])<2.4 && Jet_puId[aJCidx]>0)',\
    'addJet30':'Sum$(Jet_pt[aJCidx]>30.)',\
    'addJetNoPU30':'Sum$(Jet_pt[aJCidx]>30. && Jet_puId[aJCidx]>0)',\
    'addCenJet30':'Sum$(Jet_pt[aJCidx]>30. && abs(Jet_eta[aJCidx])<2.4)',\
    'addCenJetNoPU30':'Sum$(Jet_pt[aJCidx]>30. && abs(Jet_eta[aJCidx])<2.4 && Jet_puId[aJCidx]>0)',\
    'addJet40':'Sum$(Jet_pt[aJCidx]>40.)',\
    'addJetNoPU40':'Sum$(Jet_pt[aJCidx]>40. && Jet_puId[aJCidx]>0)',\
    'addCenJet40':'Sum$(Jet_pt[aJCidx]>40. && abs(Jet_eta[aJCidx])<2.4)',\
    'addCenJetNoPU40':'Sum$(Jet_pt[aJCidx]>40. && abs(Jet_eta[aJCidx])<2.4 && Jet_puId[aJCidx]>0)',\
    'pt_1':'max(Jet_pt[hJCidx[0]],Jet_pt[hJCidx[1]])',\
    'pt_2':'min(Jet_pt[hJCidx[0]],Jet_pt[hJCidx[1]])',\
    'addJet40':'Sum$(Jet_pt[aJCidx]>40.)',\
    'minDeltaPhiJet1Met':'MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi)),Iteration$<1)',\
    'minDeltaPhiJet2Met':'MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi)),Iteration$<2)',\
    'minDeltaPhiJet3Met':'MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi)),Iteration$<3)',\
    'minDeltaPhiJet4Met':'MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi)),Iteration$<4)',\
    'minDeltaPhiCenJetNoPU20Met':'MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi)),Jet_pt>20 && Jet_eta<2.5 && Jet_puId)',\
    'minDeltaPhiCenJetNoPU30Met':'MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi)),Jet_pt>30 && Jet_eta<2.5 && Jet_puId)',\
    'minDeltaPhiJetNoPU30Met':'MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi)),Jet_pt>30 && Jet_puId)',\
    'minDeltaPhiCenJet30Met':'MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi)),Jet_pt>30 && Jet_eta<2.5 )',\
    'minDeltaPhiJet30Met':'MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi)),Jet_pt>30  && Jet_eta<5.2 )',\
    'minDeltaPhiJet25Met':'MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi)),Jet_pt>25  && Jet_eta<5.2 )',\
    'minDeltaPhiCenJetNoPU40Met':'MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi)),Jet_pt>40 && Jet_eta<2.5 && Jet_puId)',\
    'minDeltaPhiCenJetNoPU50Met':'MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi)),Jet_pt>50 && Jet_eta<2.5 && Jet_puId)',\
    'minDeltaPhiCenJetNoPU60Met':'MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi)),Jet_pt>60 && Jet_eta<2.5 && Jet_puId)',\
    'minDeltaPhiCenJetNoPU70Met':'MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi)),Jet_pt>70 && Jet_eta<2.5 && Jet_puId)',\
    'minDeltaPhiCenJetNoPU80Met':'MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi)),Jet_pt>80 && Jet_eta<2.5 && Jet_puId)',\
    'minDeltaPhiJetNoPU80Met':'MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi)),Jet_pt>80 && Jet_puId)',\
    'minDeltaPhiCenJet80Met':'MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi)),Jet_pt>80 && Jet_eta<2.5 )',\
    'minDeltaPhiJet80Met':'MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi)),Jet_pt>80 )',\
    'minDeltaPhiJet90Met':'MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi)),Jet_pt>90 )',\
    'minDeltaPhiJet100Met':'MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi)),Jet_pt>100)',\
    'minDeltaPhiJetMet20NoPU':'MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi)),Jet_pt>20 && Jet_puId>=1)',\
    'minDeltaPhiJetMet20Higgs':'MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi[hJCidx]-met_phi)),Jet_pt[hJCidx]>20 && Jet_puId[hJCidx]>=1)',\
    'metmetType1p2_sig':'metType1p2_pt/sqrt(met_sumEt)',\
    'metPuppi_sig':'metPuppi_pt/sqrt(met_sumEt)',\
    'met_sig':'met_pt/sqrt(met_sumEt)',\
    'met_sig':'met_pt/sqrt(met_sumEt)',\
    'DeltaPhiJet1Jet2':'abs(TVector2::Phi_mpi_pi(Jet_phi[0]-Jet_phi[1]))',\
    'DeltaPhiHMET':'abs(TVector2::Phi_mpi_pi(H_phi-met_phi))',\
    'DeltaPhiHCSVMET':'abs(TVector2::Phi_mpi_pi(HCSV_phi-met_phi))',\
    'VetoMuon':'(Sum$(aLeptons_looseIdPOG>0 && aLeptons_pfRelIso04<0.50 && abs(aLeptons_pdgId)==13 && aLeptons_pt>5) + Sum$(vLeptons_looseIdPOG>0 && vLeptons_pfRelIso04<0.50 && abs(vLeptons_pdgId)==13 && vLeptons_pt>5))',\
    'TightMuon':'(Sum$(aLeptons_tightId>0 && aLeptons_pfRelIso04<0.15 && abs(aLeptons_pdgId)==13 && aLeptons_pt>20) + Sum$(vLeptons_tightId>0 && vLeptons_pfRelIso04<0.15 && abs(vLeptons_pdgId)==13 && vLeptons_pt>20))',\
    'VetoElectron':'(Sum$(aLeptons_eleCutIdSpring15_25ns_v1>0 && aLeptons_pfRelIso04<0.50 && abs(aLeptons_pdgId)==11 && aLeptons_pt>5) + Sum$(vLeptons_eleCutIdSpring15_25ns_v1>0 && vLeptons_pfRelIso04<0.50 && abs(vLeptons_pdgId)==11 && vLeptons_pt>5))',\
    'TightElectron':'(Sum$(aLeptons_eleCutIdSpring15_25ns_v1>3 && aLeptons_pfRelIso04<0.15 && abs(aLeptons_pdgId)==11 && aLeptons_pt>20) + Sum$(vLeptons_eleCutIdSpring15_25ns_v1>3 && vLeptons_pfRelIso04<0.15 && abs(vLeptons_pdgId)==11 && vLeptons_pt>20))',\
    'htJet30noLeptnoPU':'Sum$(Jet_pt * (abs(Jet_eta)<2.4) * (Jet_pt>30) * (Jet_puId>=1))',\
    'htJet30noLept':'Sum$(Jet_pt * (abs(Jet_eta)<2.4) * (Jet_pt>30) )',\
    'genMHT':'(Sum$(GenJet_pt * (abs(GenJet_eta)<2.4) * (GenJet_pt>30) * sin(GenJet_phi))**2+Sum$(GenJet_pt * (abs(GenJet_eta)<2.4) * (GenJet_pt>30) * cos(GenJet_phi))**2)**0.5',\
    'mhtJet30noLept':'(Sum$(Jet_pt * (abs(Jet_eta)<2.4) * (Jet_pt>30) * sin(Jet_phi))**2+Sum$(Jet_pt * (abs(Jet_eta)<2.4) * (Jet_pt>30) * cos(Jet_phi))**2)**0.5',\
    'VetoLeptons':'Sum$(aLeptons_eleCutIdSpring15_25ns_v1>0 && aLeptons_pfRelIso04<0.50 && abs(aLeptons_pdgId)==11 && aLeptons_pt>5) + Sum$(vLeptons_eleCutIdSpring15_25ns_v1>0 && vLeptons_pfRelIso04<0.50 && abs(vLeptons_pdgId)==11 && vLeptons_pt>5)+(Sum$(aLeptons_looseIdPOG>0 && aLeptons_pfRelIso04<0.50 && abs(aLeptons_pdgId)==13 && aLeptons_pt>5) + Sum$(vLeptons_looseIdPOG>0 && vLeptons_pfRelIso04<0.50 && abs(vLeptons_pdgId)==13 && vLeptons_pt>5))',\
    'TightLeptons':'(Sum$(aLeptons_eleCutIdSpring15_25ns_v1>3 && aLeptons_pfRelIso04<0.15 && abs(aLeptons_pdgId)==11 && aLeptons_pt>20) + Sum$(vLeptons_eleCutIdSpring15_25ns_v1>3 && vLeptons_pfRelIso04<0.15 && abs(vLeptons_pdgId)==11 && vLeptons_pt>20))+(Sum$(aLeptons_tightId>0 && aLeptons_pfRelIso04<0.15 && abs(aLeptons_pdgId)==13 && aLeptons_pt>20) + Sum$(vLeptons_tightId>0 && vLeptons_pfRelIso04<0.15 && abs(vLeptons_pdgId)==13 && vLeptons_pt>20))',\
    'CleaningBadECAL':'(!Alt$(Jet_over[0],0) && !Alt$(Jet_overMC[0],0) && Sum$((Jet_under||Jet_underMC) * (Jet_pt>25) * (abs(TVector2::Phi_mpi_pi ( Jet_phi-met_phi ))<0.785))==0)',\
    'CleaningHotECAL':'(!Alt$(Jet_over[0],0) && !Alt$(Jet_overMC[0],0))',\
    'CleaningDeadECAL':'(Sum$((Jet_under||Jet_underMC) * (Jet_pt>25) * (abs(TVector2::Phi_mpi_pi ( Jet_phi-met_phi ))<0.785))==0)',\
    'METProjection30Squared':'((Sum$(Jet_pt*(max(0,cos(abs(TVector2::Phi_mpi_pi(met_phi - Jet_phi))))**2)*(Jet_puId>=1)*(Jet_pt>30))))',\
    'METProjection15Squared':'((Sum$(Jet_pt*(max(0,cos(abs(TVector2::Phi_mpi_pi(met_phi - Jet_phi))))**2)*(Jet_puId>=1)*(Jet_pt>15))))',\
    'AntiQCD':'((Sum$(Jet_pt*(max(0,cos(abs(TVector2::Phi_mpi_pi(met_phi - Jet_phi))))**2)*(Jet_puId>=1)*(Jet_pt>15)))<40)',\
    'AntiSoftLetponDecay':'(Sum$(abs(TVector2::Phi_mpi_pi ( aLeptons_phi-met_phi ))<0.5 && (aLeptons_pt>5) )==0)',\
    'ptWeight':'((nGenHiggsBoson>0||nGenTop>0)? 1: (VHbb::ptWeightQCD(nGenVbosons, lheHT, Alt$(GenVbosons_pdgId[0],0)) * VHbb::ptWeightEWK(nGenVbosons, Alt$(GenVbosons_pt[0],0), VtypeSim, Alt$(GenVbosons_pdgId[0],0))))',\
    'puWeightNew':'VHbb::weight2( nTrueInt )',\
    'puWeightNew_up':'VHbb::weight2_up( nTrueInt )',\
    'puWeightNew_down':'VHbb::weight2_down( nTrueInt )',\
    'sign_genWeight':'sign(genWeight)',\
    'nJets40':'Sum$(Jet_pt>40 && abs(Jet_eta)<5.2)',\
    'FlagsMET':'Flag_hbheFilterNew  &&Flag_hbheIsoFilter &&Flag_CSCTightHaloFilter &&Flag_eeBadScFilter && Flag_goodVertices && Flag_EcalDeadCellTriggerPrimitiveFilter',\
    'triggerWeight':'(1-((0.5-(0.5*TMath::Erf((min(met_pt,mhtJet30)+1.01096)/60.155)))*13.8885))-0.00244511',\
    'triggerWeightUp':'(1-((0.5-(0.5*TMath::Erf((min(met_pt,mhtJet30)+5.2974)/60.155)))*13.8885))+5.73593e-05',\
    'triggerWeightDown':'(1-((0.5-(0.5*TMath::Erf((min(met_pt,mhtJet30)-3.02447)/60.155)))*13.8885))-0.00494959',\
    'triggerWeightEle':'(1-((0.5-(0.5*TMath::Erf((min(met_pt,mhtJet30)-1.0251)/80.9061)))*2.83573))+0.000123818',\
    'triggerWeightEleUp':'(1-((0.5-(0.5*TMath::Erf((min(met_pt,mhtJet30)+4.98639)/80.9061)))*2.83573))+0.00261716',\
    'triggerWeightEleDown':'(1-((0.5-(0.5*TMath::Erf((min(met_pt,mhtJet30)-6.3768)/80.9061)))*2.83573))-0.00304971',\
    'METJet':'Max$(exp(-0.5*abs(TVector2::Phi_mpi_pi(met_phi - Jet_phi))**2/(0.3**2)) * Jet_pt)',
    'METJetNoPU':'Max$(exp(-0.5*abs(TVector2::Phi_mpi_pi(met_phi - Jet_phi))**2/(0.3**2)) * Jet_pt * (Jet_puId>=1))',
    'METJetHiggs':'Max$(exp(-0.5*abs(TVector2::Phi_mpi_pi(met_phi - Jet_phi[hJCidx]))**2/(0.3**2)) * Jet_pt[hJCidx])',
    'minDeltaPhiJetMet15NoPU':'MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi)),Jet_pt>15 && Jet_puId>=1)',\
    'minDeltaPhiJetMet20NoPU':'MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi)),Jet_pt>20 && Jet_puId>=1)',\
    'minDeltaPhiJetMet25NoPU':'MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi)),Jet_pt>25 && Jet_puId>=1)',\
    'minDeltaPhiJetMet30NoPU':'MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi)),Jet_pt>30 && Jet_puId>=1)',\
    'minDeltaPhiJetMet35NoPU':'MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi)),Jet_pt>35 && Jet_puId>=1)',\
    'minDeltaPhiJetMet40NoPU':'MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi)),Jet_pt>40 && Jet_puId>=1)',\
    'minDeltaPhiJetMetHiggs':'MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi[hJCidx]-met_phi)),Jet_puId[hJCidx]>=1)',\
    'minDeltaPhiJetMetTwoLeading':'MinIf$(abs(TVector2::Phi_mpi_pi(Jet_phi-met_phi)),Jet_puId>=1 && Iteration$<=1)',\
    }

regWeight = weights/MVA_BDT_REG_ZvvHbbRegression_ZH.weights.xml

regVars = ['Alt$(Jet_pt[hJCidx],0)', 'VHbb::evalEtFromPtEtaPhiM(Alt$(Jet_pt[hJCidx],0),Alt$(Jet_eta[hJCidx],0),Alt$(Jet_phi[hJCidx],0),Alt$(Jet_mass[hJCidx],0))', 'Alt$(rho[hJCidx],0)', 'Alt$(Jet_eta[hJCidx],0)', 'VHbb::evalMtFromPtEtaPhiM(Alt$(Jet_pt[hJCidx],0),Alt$(Jet_eta[hJCidx],0),Alt$(Jet_phi[hJCidx],0),Alt$(Jet_mass[hJCidx],0))', 'Alt$(Jet_leadTrackPt[hJCidx],0)', 'max(Alt$(Jet_leptonPtRel[hJCidx],0),0)', 'max(Alt$(Jet_leptonPt[hJCidx],0),0)', 'max(Alt$(Jet_leptonDeltaR[hJCidx],0),0)', 'Alt$(Jet_vtxPt[hJCidx],0)', 'Alt$(Jet_vtxMass[hJCidx],0)', 'Alt$(Jet_vtx3DVal[hJCidx],0)', 'Alt$(Jet_vtxNtracks[hJCidx],0)', 'Alt$(Jet_vtx3DSig[hJCidx],0)', 'Alt$(Jet_chEmEF[hJCidx],0)', 'Alt$(Jet_neEmEF[hJCidx],0)']

regDict = {'VHbb::evalEtFromPtEtaPhiM(Alt$(Jet_pt[hJCidx],0),Alt$(Jet_eta[hJCidx],0),Alt$(Jet_phi[hJCidx],0),Alt$(Jet_mass[hJCidx],0))': 'VHbb::evalEtFromPtEtaPhiM(Alt$(Jet_pt[hJCidx[0]],0),Alt$(Jet_eta[hJCidx[0]],0),Alt$(Jet_phi[hJCidx[0]],0),Alt$(Jet_mass[hJCidx[0]],0))', 'Alt$(Jet_vtxMass[hJCidx],0)': 'Alt$(Jet_vtxMass[hJCidx[0]] ,0)', 'Alt$(Jet_leadTrackPt[hJCidx],0)': 'Alt$(Jet_leadTrackPt[hJCidx[0]] ,0)', 'Alt$(Jet_vtxNtracks[hJCidx],0)': 'Alt$(Jet_vtxNtracks[hJCidx[0]] ,0)', 'Alt$(Jet_vtxPt[hJCidx],0)': 'Alt$(Jet_vtxPt[hJCidx[0]] ,0)', 'Alt$(Jet_vtx3DVal[hJCidx],0)': 'Alt$(Jet_vtx3DVal[hJCidx[0]] ,0)', 'Alt$(Jet_eta[hJCidx],0)': 'Alt$(Jet_eta[hJCidx[0]] ,0)', 'Alt$(Jet_vtx3DSig[hJCidx],0)': 'Alt$(Jet_vtx3DSig[hJCidx[0]] ,0)', 'Alt$(rho[hJCidx],0)': 'Alt$(rho[hJCidx[0]] ,0)', 'max(Alt$(Jet_leptonPtRel[hJCidx],0),0)': 'max(Alt$(Jet_leptonPtRel[hJCidx[0]] ,0),0)', 'Alt$(Jet_pt[hJCidx],0)': 'Alt$(Jet_pt[hJCidx[0]] ,0)', 'max(Alt$(Jet_leptonPt[hJCidx],0),0)': 'max(Alt$(Jet_leptonPt[hJCidx[0]] ,0),0)', 'VHbb::evalMtFromPtEtaPhiM(Alt$(Jet_pt[hJCidx],0),Alt$(Jet_eta[hJCidx],0),Alt$(Jet_phi[hJCidx],0),Alt$(Jet_mass[hJCidx],0))': 'VHbb::evalMtFromPtEtaPhiM(Alt$(Jet_pt[hJCidx[0]] ,0),Alt$(Jet_eta[hJCidx[0]] ,0),Alt$(Jet_phi[hJCidx[0]] ,0),Alt$(Jet_mass[hJCidx[0]] ,0))', 'max(Alt$(Jet_leptonDeltaR[hJCidx],0),0)': 'max(Alt$(Jet_leptonDeltaR[hJCidx[0]] ,0),0)', 'Alt$(Jet_chEmEF[hJCidx],0)':'Alt$(Jet_chEmEF[hJCidx[0]],0)', 'Alt$(Jet_neEmEF[hJCidx],0)':'Alt$(Jet_neEmEF[hJCidx[0]],0)'}

regWeightFilterJets = weights/MVA_BDT_REG_MyRegression.weights.xml

regVarsFilterJets = ["fathFilterJets_pt","VHbb::evalJERBias(fathFilterJets_ptRaw,fathFilterJets_genPt,fathFilterJets_eta)","rho25","VHbb::evalEt(fathFilterJets_pt,fathFilterJets_eta,fathFilterJets_phi,fathFilterJets_e)","VHbb::evalMt(fathFilterJets_pt,fathFilterJets_eta,fathFilterJets_phi,fathFilterJets_e)","fathFilterJets_ptLeadTrack","metPuppi_pt","VHbb::deltaPhi(met_phi,fathFilterJets_phi)"]

regDictFilterJets = {"fathFilterJets_pt":"fathFilterJets_pt[0]","VHbb::evalJERBias(fathFilterJets_ptRaw,fathFilterJets_genPt,fathFilterJets_eta)":"VHbb::evalJERBias(fathFilterJets_ptRaw[0],fathFilterJets_genPt[0],fathFilterJets_eta[0])","rho25":"rho25","VHbb::evalEt(fathFilterJets_pt,fathFilterJets_eta,fathFilterJets_phi,fathFilterJets_e)":"VHbb::evalEt(fathFilterJets_pt[0],fathFilterJets_eta[0],fathFilterJets_phi[0],fathFilterJets_e[0])","VHbb::evalMt(fathFilterJets_pt,fathFilterJets_eta,fathFilterJets_phi,fathFilterJets_e)":"VHbb::evalMt(fathFilterJets_pt[0],fathFilterJets_eta[0],fathFilterJets_phi[0],fathFilterJets_e[0])","fathFilterJets_ptLeadTrack":"fathFilterJets_ptLeadTrack[0]","metPuppi_pt":"METet","VHbb::deltaPhi(met_phi,fathFilterJets_phi)":"VHbb::deltaPhi(met_phi,fathFilterJets_phi[0])"}

